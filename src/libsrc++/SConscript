# scons build file for evio
Import('env', 'archDir', 'libInstallDir', 'incInstallDir', 'archIncInstallDir', 'debugSuffix')

# Need to copy the environment here or else when compiling the C evio lib, the values set for LIBS below
# will also be invoked while compiling the evio lib, resulting in a circular reference with the evio lib
# depending on itself!
myEnv = env.Clone()

# Headers to install
headerList = Glob('*.h*',  strings=True)

# Files to compile
fileList = Glob('*.cc',  strings=True)

myEnv.AppendUnique(CPPPATH = ['.', '#src/libsrc'], LIBS = ['expat', 'evio'+debugSuffix], LIBPATH = ['/usr/lib', '#src/libsrc/'+archDir])

#evioxxLib = env.SharedLibrary(target = 'evioxx'+debugSuffix, source = fileList, SHLIBVERSION="5.3")
evioxxLib = myEnv.SharedLibrary(target = 'evioxx'+debugSuffix, source = fileList)

if 'install' in COMMAND_LINE_TARGETS:
    print("archDir = " + archDir)
    myEnv.Alias("install", myEnv.Install(target = [incInstallDir, archIncInstallDir], source = headerList))
    myEnv.Alias("install", myEnv.Install(target = libInstallDir, source = evioxxLib))
